stream {
    upstream backend_api {
        server bootstrap-0.${cluster_name}.${cluster_basedomain}:6443;
        %{ for i in c_m ~}
        server master-${i}.${cluster_name}.${cluster_basedomain}:6443;
        %{ endfor }
    }

    server {
        listen 6443;
        proxy_pass backend_api;
    }

    upstream backend_mcs {
        server bootstrap-0.${cluster_name}.${cluster_basedomain}:22623;
        %{ for i in count_master ~}
        server master-${i}.${cluster_name}.${cluster_basedomain}:22623;
        %{ endfor }
    }

    server {
        listen 22623;
        proxy_pass backend_mcs;
    }

    upstream backend_https {
        %{ for i in count_compute ~}
        server worker-${i}.${cluster_name}.${cluster_basedomain}:443;
        %{ endfor }
    }

    server {
        listen 443;
        proxy_pass backend_https;
    }
}
